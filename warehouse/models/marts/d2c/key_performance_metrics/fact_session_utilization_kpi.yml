version: 2

models:
  - name: fact_session_utilization_kpi
    meta:
      owner: "adrian.lievano@betterup.co"
    description: "Stores calculation for Session Utilization Rates"
    columns:
      - name: _unique
        description: "Primary key of this table. Sets the grain to month and metric_name, ensuring no metric has multiple values and/or targets"
        tests:
          - unique
          - not_null

      - name: metric_name_id
        description: "Surrogate key on the manually written metric_name"

      - name: month
        description: "calendar month that the metric is calculated"
        tests: 
          - not_null

      - name: metric_value
        description: "Calculated value for the metric in a given month"
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0.60
              max_value: 0.70
              row_condition: "month = '2023-05-01'"
              config:
                severity: warn
        ##These tests ensure that our ratios are between 0 and 1 where appropriate
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0.0
              max_value: 1.0
              row_condition: "metric_name = 'session_utilization' and month >= '2022-08-01'"
              config:
                severity: warn
