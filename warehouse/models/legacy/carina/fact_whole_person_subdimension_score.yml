version: 2
models:
  - name: fact_whole_person_subdimension_score
    description: >
      Fact table for Whole Person Model Subdimension Scores, currently for Onboarding and
      Reflection Point, but designed to support Pulse assessments as well (for 180 and 360
      subdimension score data, see the `fact_whole_person_contributor_group_subdimension_score`
      model). Assessments in this table are limited to external deployments and assessments
      that have been completed (i.e. not currently in progress). This fact table is currently
      implemented as expanded version of `fact_whole_person_assessment` with grain of one
      row per member per assessment per subdimension.

    columns:
      - name: member_key
        description: Foreign key to conformed Member dimension.
        tests:
          - not_null

      - name: date_key
        description: >
         Foreign key to conformed Date dimension for the date the associated
         assessment was completed.
        tests:
          - not_null
          - relationships:
              to: ref('dim_date')
              field: date_key

      - name: account_key
        description: >
          Foreign key to conformed Account dimension for the account the member was
          associated with on the day the current assessment was completed.
        tests:
          - not_null

      - name: deployment_key
        description: >
          Foreign key to conformed Deployment dimension for the deployment associated
          with the assessment.
        tests:
          - not_null
          - relationships:
              to: ref('dim_deployment')
              field: deployment_key

      - name: member_deployment_key
        description: Foreign key to conformed Member-Deployment dimension.
        tests:
          - not_null

      - name: whole_person_subdimension_key
        description: >
          Foreign Key to `dim_whole_person_subdimension`.
        tests:
           - not_null

      - name: assessment_name
        description: >
          String denoting the type of current WPM assessment.
        tests:
          - not_null

      - name: scale_score
        description: >
          Scale score generated by the application for the subdimension.

      - name: baseline_assessment_name
        description: >
          String denoting the type of associated baseline WPM assessment. Baseline
          assessment is defined as the first WPM assessment with same version (1.0 vs 2.0)
          as the associated record. In most cases the baseline assessment will be the member's
          onboarding assessment, although in rare cases the first assessment taken by a member
          is a Reflection Point. N/A if no baseline assessment exists.
        tests:
          - not_null

      - name: baseline_scale_score
        description: >
          Baseline scale score for comparison to the current subdimension scale score.
          NULL if no baseline assessment exists.

      - name: scale_score_growth_from_baseline
        description: >
          Difference in scale score between baseline assessment and current assessment
          for the associated subdimension. Growth score will be positive if current score is
          higher than baseline, and negative otherwise. Will be NULL if no baseline assessment
          exists.

      - name: baseline_days_before_current
        description: >
          Integer denoting how many days have passed between the baseline and
          the current assessment.

      - name: preceding_assessment_name
        description: >
          String denoting the type of preceding WPM assessment. Preceding assessment is defined
          as the most recent WPM assessment with same version (1.0 vs 2.0) that was submitted
          prior to the current assessment associated with the given record. N/A if no
          preceding assessment exists. Note: baseline and preceding assessments can represent
          the same assessment, as in the case where the current assessment is the second
          assessment in the member's sequence.
        tests:
          - not_null

      - name: preceding_scale_score
        description: >
          Preceding scale score for comparison to the current subdimension scale score.
          NULL if no preceding assessment exists.

      - name: scale_score_growth_from_preceding
        description: >
          Difference in scale score between preceding assessment and current assessment
          for the associated subdimension. Growth score will be positive if current score is
          higher than preceding, and negative otherwise. Will be NULL if no preceding assessment
          exists.

      - name: preceding_days_before_current
        description: >
          Integer denoting how many days have passed between the preceding and
          the current assessment.

      - name: account_assessment_sequence
        description: >
          Integer that represents the sequence of the assessment for the member scoped
          to `assessment_name` and `account`
        tests:
          - not_null

      - name: deployment_assessment_sequence
        description: >
          Integer that represents the sequence of the assessment for the member scoped
          to `assessment_name` and `deployment_key`
        tests:
          - not_null

      - name: account_wpm_sequence
        description: >
          Integer that represents the sequence of the assessment for the member scoped
          to `account` and version of Whole Person Model.
        tests:
          - not_null

      - name: member_wpm_sequence
        description: >
          Integer that represents the sequence of the assessment for the member scoped
          to version of Whole Person Model.
        tests:
          - not_null

      - name: deployment_wpm_sequence
        description: >
          Integer that represents the sequence of the assessment for the member scoped
          to `deployment_key` and version of Whole Person Model.
        tests:
          - not_null

      - name: deployment_assessment_reverse_sequence
        description: >
          Integer that represents the reverse sequence of the assessment for the member scoped
          to `assessment_name` and `deployment_key`. Specifically, the most recent
          assessment submitted will have a reverse sequence = 1.
        tests:
          - not_null

      - name: app_assessment_id
        description: >
          Foreign key to the assessment that's associated with the subdimension scores.
        tests:
          - not_null
          - relationships:
              to: ref('dei_member_assessments')
              field: assessment_id

      - name: baseline_app_assessment_id
        description: >
          Foreign key to the baseline assessment that's associated with the subdimension score.
          Note: can be NULL if no baseline assessment exists for the current subdimension score.
        tests:
          - relationships:
              to: ref('dei_member_assessments')
              field: assessment_id

      - name: preceding_app_assessment_id
        description: >
          Foreign key to the preceding assessment that's associated with the subdimension score.
          Note: can be NULL if no preceding assessment exists for the current subdimension score.
        tests:
          - relationships:
              to: ref('dei_member_assessments')
              field: assessment_id
